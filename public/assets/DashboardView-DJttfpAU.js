import{l as lt,m as ut,r as N,n as dt,k as ct,c as z,o as H,b as n,e as ft,f as tt,t as $,p as rt,q as at,s as nt,w as ht,x as vt,y as gt,z as mt,A as pt,T as yt}from"./index-B8P_votN.js";const bt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23ffffff%20'%3e%3cpath%20d='M480-320q75%200%20127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75%200-127.5%2052.5T300-500q0%2075%2052.5%20127.5T480-320Zm0-72q-45%200-76.5-31.5T372-500q0-45%2031.5-76.5T480-608q45%200%2076.5%2031.5T588-500q0%2045-31.5%2076.5T480-392Zm0%20192q-146%200-266-81.5T40-500q54-137%20174-218.5T480-800q146%200%20266%2081.5T920-500q-54%20137-174%20218.5T480-200Zm0-300Zm0%20220q113%200%20207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113%200-207.5%2059.5T128-500q50%20101%20144.5%20160.5T480-280Z'/%3e%3c/svg%3e",ot="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23ffffff%20'%3e%3cpath%20d='M504-480%20320-664l56-56%20240%20240-240%20240-56-56%20184-184Z'/%3e%3c/svg%3e";var K={exports:{}},xt=K.exports,it;function $t(){return it||(it=1,function(et,J){(function(g,q){et.exports=q()})(xt,function(){var g=1e3,q=6e4,A=36e5,w="millisecond",T="second",E="minute",b="hour",M="day",j="week",_="month",I="quarter",k="year",L="date",P="Invalid Date",X=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Z=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,R={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(o){var s=["th","st","nd","rd"],t=o%100;return"["+o+(s[(t-20)%10]||s[t]||s[0])+"]"}},d=function(o,s,t){var a=String(o);return!a||a.length>=s?o:""+Array(s+1-a.length).join(t)+o},r={s:d,z:function(o){var s=-o.utcOffset(),t=Math.abs(s),a=Math.floor(t/60),e=t%60;return(s<=0?"+":"-")+d(a,2,"0")+":"+d(e,2,"0")},m:function o(s,t){if(s.date()<t.date())return-o(t,s);var a=12*(t.year()-s.year())+(t.month()-s.month()),e=s.clone().add(a,_),i=t-e<0,l=s.clone().add(a+(i?-1:1),_);return+(-(a+(t-e)/(i?e-l:l-e))||0)},a:function(o){return o<0?Math.ceil(o)||0:Math.floor(o)},p:function(o){return{M:_,y:k,w:j,d:M,D:L,h:b,m:E,s:T,ms:w,Q:I}[o]||String(o||"").toLowerCase().replace(/s$/,"")},u:function(o){return o===void 0}},u="en",p={};p[u]=R;var D="$isDayjsObject",O=function(o){return o instanceof G||!(!o||!o[D])},C=function o(s,t,a){var e;if(!s)return u;if(typeof s=="string"){var i=s.toLowerCase();p[i]&&(e=i),t&&(p[i]=t,e=i);var l=s.split("-");if(!e&&l.length>1)return o(l[0])}else{var f=s.name;p[f]=s,e=f}return!a&&e&&(u=e),e||!a&&u},h=function(o,s){if(O(o))return o.clone();var t=typeof s=="object"?s:{};return t.date=o,t.args=arguments,new G(t)},c=r;c.l=C,c.i=O,c.w=function(o,s){return h(o,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var G=function(){function o(t){this.$L=C(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[D]=!0}var s=o.prototype;return s.parse=function(t){this.$d=function(a){var e=a.date,i=a.utc;if(e===null)return new Date(NaN);if(c.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var l=e.match(X);if(l){var f=l[2]-1||0,v=(l[7]||"0").substring(0,3);return i?new Date(Date.UTC(l[1],f,l[3]||1,l[4]||0,l[5]||0,l[6]||0,v)):new Date(l[1],f,l[3]||1,l[4]||0,l[5]||0,l[6]||0,v)}}return new Date(e)}(t),this.init()},s.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},s.$utils=function(){return c},s.isValid=function(){return this.$d.toString()!==P},s.isSame=function(t,a){var e=h(t);return this.startOf(a)<=e&&e<=this.endOf(a)},s.isAfter=function(t,a){return h(t)<this.startOf(a)},s.isBefore=function(t,a){return this.endOf(a)<h(t)},s.$g=function(t,a,e){return c.u(t)?this[a]:this.set(e,t)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(t,a){var e=this,i=!!c.u(a)||a,l=c.p(t),f=function(V,x){var Y=c.w(e.$u?Date.UTC(e.$y,x,V):new Date(e.$y,x,V),e);return i?Y:Y.endOf(M)},v=function(V,x){return c.w(e.toDate()[V].apply(e.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(x)),e)},m=this.$W,y=this.$M,S=this.$D,W="set"+(this.$u?"UTC":"");switch(l){case k:return i?f(1,0):f(31,11);case _:return i?f(1,y):f(0,y+1);case j:var U=this.$locale().weekStart||0,B=(m<U?m+7:m)-U;return f(i?S-B:S+(6-B),y);case M:case L:return v(W+"Hours",0);case b:return v(W+"Minutes",1);case E:return v(W+"Seconds",2);case T:return v(W+"Milliseconds",3);default:return this.clone()}},s.endOf=function(t){return this.startOf(t,!1)},s.$set=function(t,a){var e,i=c.p(t),l="set"+(this.$u?"UTC":""),f=(e={},e[M]=l+"Date",e[L]=l+"Date",e[_]=l+"Month",e[k]=l+"FullYear",e[b]=l+"Hours",e[E]=l+"Minutes",e[T]=l+"Seconds",e[w]=l+"Milliseconds",e)[i],v=i===M?this.$D+(a-this.$W):a;if(i===_||i===k){var m=this.clone().set(L,1);m.$d[f](v),m.init(),this.$d=m.set(L,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](v);return this.init(),this},s.set=function(t,a){return this.clone().$set(t,a)},s.get=function(t){return this[c.p(t)]()},s.add=function(t,a){var e,i=this;t=Number(t);var l=c.p(a),f=function(y){var S=h(i);return c.w(S.date(S.date()+Math.round(y*t)),i)};if(l===_)return this.set(_,this.$M+t);if(l===k)return this.set(k,this.$y+t);if(l===M)return f(1);if(l===j)return f(7);var v=(e={},e[E]=q,e[b]=A,e[T]=g,e)[l]||1,m=this.$d.getTime()+t*v;return c.w(m,this)},s.subtract=function(t,a){return this.add(-1*t,a)},s.format=function(t){var a=this,e=this.$locale();if(!this.isValid())return e.invalidDate||P;var i=t||"YYYY-MM-DDTHH:mm:ssZ",l=c.z(this),f=this.$H,v=this.$m,m=this.$M,y=e.weekdays,S=e.months,W=e.meridiem,U=function(x,Y,F,Q){return x&&(x[Y]||x(a,i))||F[Y].slice(0,Q)},B=function(x){return c.s(f%12||12,x,"0")},V=W||function(x,Y,F){var Q=x<12?"AM":"PM";return F?Q.toLowerCase():Q};return i.replace(Z,function(x,Y){return Y||function(F){switch(F){case"YY":return String(a.$y).slice(-2);case"YYYY":return c.s(a.$y,4,"0");case"M":return m+1;case"MM":return c.s(m+1,2,"0");case"MMM":return U(e.monthsShort,m,S,3);case"MMMM":return U(S,m);case"D":return a.$D;case"DD":return c.s(a.$D,2,"0");case"d":return String(a.$W);case"dd":return U(e.weekdaysMin,a.$W,y,2);case"ddd":return U(e.weekdaysShort,a.$W,y,3);case"dddd":return y[a.$W];case"H":return String(f);case"HH":return c.s(f,2,"0");case"h":return B(1);case"hh":return B(2);case"a":return V(f,v,!0);case"A":return V(f,v,!1);case"m":return String(v);case"mm":return c.s(v,2,"0");case"s":return String(a.$s);case"ss":return c.s(a.$s,2,"0");case"SSS":return c.s(a.$ms,3,"0");case"Z":return l}return null}(x)||l.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(t,a,e){var i,l=this,f=c.p(a),v=h(t),m=(v.utcOffset()-this.utcOffset())*q,y=this-v,S=function(){return c.m(l,v)};switch(f){case k:i=S()/12;break;case _:i=S();break;case I:i=S()/3;break;case j:i=(y-m)/6048e5;break;case M:i=(y-m)/864e5;break;case b:i=y/A;break;case E:i=y/q;break;case T:i=y/g;break;default:i=y}return e?i:c.a(i)},s.daysInMonth=function(){return this.endOf(_).$D},s.$locale=function(){return p[this.$L]},s.locale=function(t,a){if(!t)return this.$L;var e=this.clone(),i=C(t,a,!0);return i&&(e.$L=i),e},s.clone=function(){return c.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},o}(),st=G.prototype;return h.prototype=st,[["$ms",w],["$s",T],["$m",E],["$H",b],["$W",M],["$M",_],["$y",k],["$D",L]].forEach(function(o){st[o[1]]=function(s){return this.$g(s,o[0],o[1])}}),h.extend=function(o,s){return o.$i||(o(s,G,h),o.$i=!0),h},h.locale=C,h.isDayjs=O,h.unix=function(o){return h(1e3*o)},h.en=p[u],h.Ls=p,h.p={},h})}(K)),K.exports}var wt=$t();const _t=lt(wt),Mt={class:"flex text-2xl font-extrabold text-gray-800 tracking-tight mb-4"},Dt={class:"text-blue-700"},St={key:0,class:"overflow-x-auto"},kt={class:"min-w-full divide-y divide-slate-200 bg-white shadow-sm"},Tt={class:"font-medium"},jt={class:"truncate"},Ot={class:"whitespace-nowrap"},Ct={class:"truncate text-gray-500"},Et={class:"text-gray-600"},Nt=["onClick"],qt={key:1,class:"text-gray-400 text-sm italic mt-4"},Lt={class:"pagination flex items-center justify-center gap-4 p-4 bg-slate-100 rounded-b shadow-sm"},Yt=["disabled"],zt={class:"text-gray-700 font-medium text-lg"},Ht=["disabled"],At={class:"text-xl font-semibold text-gray-600 mb-8"},It={class:"font-bold"},Ut={class:"flex gap-2 mb-2"},Vt=["value"],Wt={class:"border border-gray-300 rounded px-3 py-2 mb-8"},Zt={class:"text-gray-500"},Bt={class:"flex justify-center"},Ft=["disabled"],Jt={__name:"DashboardView",setup(et){const J=N(!1),g=N(null),q=N([]),A=N([]),w=N({page:1,totalPages:1}),T=N("Usuario"),E=N(!1),b=N(!1),M=N(null),j=d=>{switch(d){case 1:return{text:"Nuevo",class:"bg-blue-100 text-blue-800"};case 2:return{text:"Contactado",class:"bg-green-100 text-green-800"};case 3:return{text:"Descartado",class:"bg-red-100 text-red-800"};default:return{text:"Desconocido",class:"bg-gray-100 text-gray-800"}}},_=d=>_t(d).format("DD/MM/YYYY");async function I(d,r={}){try{const u=await fetch(d,{...r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,...r.headers}});if(!u.ok){const D=u.headers.get("content-type");let O="Error en la solicitud";if(D&&D.includes("application/json"))O=(await u.json()).mensaje||`Error ${u.status}`;else{const C=await u.text();console.error("Respuesta no JSON:",C),O=`Error ${u.status}: Respuesta no vÃ¡lida del servidor`}throw new Error(O)}const p=u.headers.get("content-type");if(p&&p.includes("application/json"))return await u.json();{const D=await u.text();throw console.error("Respuesta no JSON:",D),new Error("La respuesta del servidor no es JSON")}}catch(u){throw console.error(`Error en ${d}:`,u),u}}async function k(d=1){b.value=!0;try{const r=await I(`http://localhost:3001/api/leads?page=${d}&limit=5`);A.value=r.data,w.value=r.pagination}catch(r){console.error("Error al cargar leads:",r),alert(`Error al cargar leads: ${r.message}`)}finally{b.value=!1}}async function L(){try{const d=await I("http://localhost:3001/api/states");q.value=d}catch(d){console.error("Error al obtener estados:",d),alert(`Error al obtener estados: ${d.message}`)}}const P=async d=>{b.value=!0;try{const r=await I(`http://localhost:3001/api/leads/${d}`);g.value=r,M.value=r.id_state_id,J.value=!0}catch(r){console.error("Error al obtener detalles del lead:",r),alert(`Error al obtener detalles del lead: ${r.message}`)}finally{b.value=!1}};async function X(){var d,r;if(!((d=g.value)!=null&&d.id)||!((r=g.value)!=null&&r.id_state_id)){alert("No se puede actualizar: datos incompletos");return}b.value=!0;try{const u=await I(`http://localhost:3001/api/leads/${g.value.id}/state`,{method:"PUT",body:JSON.stringify({id_state_id:g.value.id_state_id})}),p=A.value.find(D=>D.id===g.value.id);p&&(p.id_state_id=g.value.id_state_id),alert(u.mensaje||"Estado actualizado correctamente"),Z()}catch(u){console.error("Error al actualizar el estado:",u),alert(`Error al actualizar el estado: ${u.message}`)}finally{b.value=!1}}const Z=()=>{J.value=!1,g.value=null,M.value=null},R=async d=>{d>0&&d<=w.value.totalPages&&await k(d)};return dt(async()=>{const d=localStorage.getItem("token");if(d)try{const r=ct(d);T.value=r.fullName||"Usuario",E.value=!0}catch(r){console.error("Error al decodificar el token:",r),T.value="Usuario",E.value=!1}else console.error("No se encontrÃ³ el token en localStorage"),alert("Por favor, inicia sesiÃ³n para continuar");await k(),await L()}),(d,r)=>(H(),z("div",null,[n("div",Mt,[n("h1",null,[r[4]||(r[4]=tt(" Bienvenido ")),n("span",Dt,$(T.value),1)]),r[5]||(r[5]=n("p",{class:"animate-bounce ml-2"},"ðŸ‘‹",-1))]),r[16]||(r[16]=n("section",{class:"py-10 px-4 text-center bg-blue-100"},[n("h2",{class:"text-2xl font-semibold mb-4"},"Lista de Leads"),n("p",{class:"max-w-2xl mx-auto"},"Consulta informaciÃ³n Ãºtil sobre todos los leads enviados.")],-1)),n("div",null,[A.value.length>0?(H(),z("div",St,[n("div",kt,[r[7]||(r[7]=n("div",{class:"grid grid-cols-7 text-left text-sm text-gray-600 font-medium bg-slate-100 px-6 py-4"},[n("div",null,"Nombre ðŸ™â€â™‚ï¸"),n("div",null,"Email ðŸ“¨"),n("div",null,"TelÃ©fono â˜Žï¸"),n("div",null,"Mensaje ðŸ’¬"),n("div",null,"Fecha ðŸ“…"),n("div",null,"Estado ðŸ” "),n("div",null,"Acciones ðŸ–±ï¸")],-1)),(H(!0),z(rt,null,at(A.value,u=>(H(),z("div",{key:u.id,class:"grid grid-cols-7 items-start text-sm text-gray-800 px-6 py-4 hover:bg-gray-50 transition-colors"},[n("div",Tt,$(u.fullName),1),n("div",jt,$(u.email),1),n("div",Ot,$(u.phone),1),n("div",Ct,$(u.msg),1),n("div",Et,$(_(u.create_at)),1),n("div",{class:nt([j(u.id_state_id).class,"font-medium mr-auto px-3 rounded-full flex items-center"])},$(j(u.id_state_id).text),3),n("button",{onClick:p=>P(u.id),class:"w-22 flex justify-center px-2 py-1 rounded bg-blue-500 hover:bg-blue-600 hover:cursor-pointer"},r[6]||(r[6]=[n("img",{src:bt,class:"h-5 w-5"},null,-1)]),8,Nt)]))),128))])])):(H(),z("p",qt,"No hay leads registrados."))]),n("div",Lt,[n("button",{onClick:r[0]||(r[0]=u=>R(w.value.page-1)),disabled:w.value.page===1,class:"flex justify-center items-center px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 font-medium"},r[8]||(r[8]=[n("img",{src:ot,class:"h-5 w-5 scale-x-[-1]"},null,-1)]),8,Yt),n("span",zt,$(w.value.page)+" de "+$(w.value.totalPages),1),n("button",{onClick:r[1]||(r[1]=u=>R(w.value.page+1)),disabled:w.value.page===w.value.totalPages,class:"flex justify-center items-center px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 font-medium"},r[9]||(r[9]=[n("img",{src:ot,class:"h-5 w-5"},null,-1)]),8,Ht)]),ft(yt,{name:"fade",mode:"out-in"},{default:ht(()=>{var u,p,D,O,C;return[J.value?(H(),z("div",{key:0,onClick:Z,class:"fixed inset-0 bg-blue-100/70 flex items-center justify-center z-50"},[n("div",{onClick:r[3]||(r[3]=pt(()=>{},["stop"])),class:"bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative"},[n("button",{onClick:Z,class:"absolute top-2 right-2 text-red-500 hover:text-red-600"},r[10]||(r[10]=[n("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),n("h2",At,[r[11]||(r[11]=tt(" Mensaje de ")),n("span",It,$(((u=g.value)==null?void 0:u.fullName)||"Lead"),1),r[12]||(r[12]=tt(" ðŸ’¬ "))]),n("div",Ut,[r[13]||(r[13]=n("label",{class:"text-gray-600 font-medium block"},"Cambiar estado",-1)),n("span",{class:nt([j((p=g.value)==null?void 0:p.id_state_id).class,"font-medium px-3 rounded-full flex items-center"])},$(j((D=g.value)==null?void 0:D.id_state_id).text),3)]),gt(n("select",{"onUpdate:modelValue":r[2]||(r[2]=h=>g.value.id_state_id=h),class:"w-full border border-gray-300 rounded px-3 py-2 mb-8 focus:outline-none focus:ring-2 focus:ring-blue-500"},[r[14]||(r[14]=n("option",{value:"",disabled:""},"Selecciona un estado",-1)),(H(!0),z(rt,null,at(q.value,h=>(H(),z("option",{key:h.id_state,value:h.id_state,class:"text-gray-500"},$(j(h.id_state).text),9,Vt))),128))],512),[[mt,g.value.id_state_id]]),r[15]||(r[15]=n("label",{class:"text-gray-600 font-medium block mb-2"},"Cuerpo del mensaje",-1)),n("div",Wt,[n("p",Zt,$(((O=g.value)==null?void 0:O.msg)||"No hay mensaje disponible"),1)]),n("div",Bt,[n("button",{onClick:X,disabled:b.value||((C=g.value)==null?void 0:C.id_state_id)===M.value,class:"px-4 py-2 w-full bg-green-500 text-white rounded-md hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200"},$(b.value?"Actualizando...":"Guardar cambios"),9,Ft)])])])):vt("",!0)]}),_:1})]))}},Rt=ut(Jt,[["__scopeId","data-v-864704df"]]);export{Rt as default};
